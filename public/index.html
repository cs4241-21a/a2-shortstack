<!doctype html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100&display=swap" rel="stylesheet">
  </head>
  <body class="center-content">
  <div id="main-div">
    <form action="" class="large">
      <h1>Data Input</h1>
      <input type='text' id='yourname' placeholder="your name here">
      <input type="text" id="grad-year" placeholder="your graduating year">
      <input type="text" id="major" placeholder="your major">
      <button>submit</button>
    </form>
    <h1>Data</h1>
    <table id="data-table" class="large">
      <tr>
        <th>
          Name
        </th>
        <th>
          Graduating Year
        </th>
        <th>
          Class Name
        </th>
        <th>
          Major
        </th>
      </tr>
    </table>
  </div>
  </body>
  <script>

  const submit = function( e ) {
    // prevent default form action from being carried out
    e.preventDefault()

    const name = document.getElementById( 'yourname' ),
            gradYear = document.getElementById('grad-year'),
            major = document.getElementById('major'),
            json =
                    {
                      name: name.value,
                      gradYear :gradYear.value,
                      major: major.value
                    },
            body = JSON.stringify( json )
    console.log(body)

    fetch( '/submit', {
      method:'POST',
      body
    }).then(response => response.json())
    .then( function( data ) {
      name.value = ""
      gradYear.value = ""
      major.value = ""
      updateTable(data)
    })
    return false
  }

  window.onload = function() {
    const button = document.querySelector( 'button' )
    button.onclick = submit
    preloadDatabase()
  }

  function updateTable(data) {
    console.log(data)
    let tr = document.createElement("tr")
    let name = document.createElement("td")
    name.textContent = data.name
    tr.appendChild(name)
    let gradYear = document.createElement("td")
    gradYear.textContent = data.gradYear
    tr.appendChild(gradYear)
    let className = document.createElement("td")
    className.textContent = data.className
    tr.appendChild(className)
    let major = document.createElement("td")
    major.textContent = data.major
    tr.appendChild(major)
    document.getElementById("data-table").appendChild(tr)
  }

  function preloadDatabase() {
    fetch('/database').then(response => response.json()).then(json => {
      console.log(json)
      json.forEach(data => {
        updateTable(data)
      })
    })
  }

  </script>
</html>
